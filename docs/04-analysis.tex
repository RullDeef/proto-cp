\chapter{Аналитический раздел}

\section{Актуальность}

Одной из наиболее актуальных задач в современном мире является обеспечение эффективного взаимодействия между удаленными пользователями.
Бессерверные аудио-видео конференции представляют собой перспективное решение, позволяющее организовывать виртуальные встречи без необходимости использования централизованных серверов.

Традиционные подходы к организации конференц-связи, основанные на клиент-серверной архитектуре, сталкиваются с рядом ограничений.
Во-первых, они требуют наличия мощной серверной инфраструктуры, которая должна обрабатывать весь трафик участников, что приводит к высоким эксплуатационным расходам.
Во-вторых, централизованные системы являются уязвимыми к сбоям и атакам, так как отказ сервера может привести к полной потере связи между пользователями.
В-третьих, такие решения зачастую ограничены в масштабируемости, что затрудняет их применение в крупномасштабных распределенных средах.

Бессерверные аудио-видео конференции, в свою очередь, обладают рядом преимуществ.
Они позволяют организовывать виртуальные встречи напрямую между участниками, без необходимости использования централизованных серверов.
Это повышает отказоустойчивость системы, поскольку отказ одного из клиентов не приводит к полной потере связи.
Кроме того, данный подход способствует снижению эксплуатационных расходов и упрощает процесс масштабирования.

Разработка протокола для организации бессерверных аудио-видео конференций является важной научно-технической задачей, имеющей высокую практическую значимость.
Результаты исследования могут найти применение в различных областях, таких как дистанционное обучение, удаленная работа, проведение виртуальных совещаний и конференций, а также во многих других сценариях, требующих эффективного взаимодействия между удаленными участниками.

\section{Потоковая передача данных в реальном времени}

Говоря о аудио-видео конференциях, следует выделить две основные составляющие потоков данных -- аудио поток и видео поток.
Аудио поток, как правило, имеет более высокий приоритет по сравнению с видео потоком, поскольку бесперебойная передача звука является критически важной для обеспечения качественного взаимодействия участников.

Основными протоколами транспортного уровня, используемыми при передаче данных в режиме реального времени, являются TCP, UDP.
На прикладном уровне часто используются такие протоколы как RTP (Real-Time Transport Protocol  \cite{rtp}), RTCP (Real-Time Transport Control Protocol  \cite{rtp}), SIP (Session Initiation Protocol \cite{sip}), H.323 \cite{h323}.

RTP и RTCP обеспечивают передачу аудио и видео с минимальной задержкой, но не предоставляют встроенных механизмов шифрования.
SIP и H.323, напротив, поддерживают управление сессиями и шифрование, но могут быть более сложными в реализации.
На основе этого анализа было принято решение рассмотреть два подхода: TCP+TLS и SRTP, как наиболее подходящие для бессерверных конференций.
Рассмотрим преимущества и недостатки каждого из подходов:

Преимущества использования TCP+TLS:

\begin{itemize}[label=---]
  \item Надежность и безопасность --- TCP гарантирует доставку данных без потерь, а TLS обеспечивает шифрование и аутентификацию, что защищает данные от перехвата и подделки.
  \item Развитая инфраструктура --- TCP и TLS широко поддерживаются, существует множество библиотек и инструментов для их реализации, что упрощает разработку и интеграцию.
\end{itemize}

Недостатки:

\begin{itemize}[label=---]
  \item Более высокая задержка --- TCP имеет больше накладных расходов по сравнению с UDP-протоколами, что может повлиять на качество аудио и видео.
  \item Более высокие требования к ресурсам --- TCP-стек требует больше памяти и вычислительных ресурсов, что может быть критично для устройств с ограниченными возможностями, такими как мобильные устройства или встраиваемые системы.
\end{itemize}

Преимущества использования SRTP:

\begin{itemize}[label=---]
  \item Низкая задержка --- SRTP, построенный поверх UDP, имеет меньше накладных расходов, что позволяет обеспечить более высокое качество аудио и видео.
  \item Меньшее потребление ресурсов --- SRTP более эффективен в плане использования памяти и вычислительной мощности, что важно для мобильных устройств.
  \item Специализация на мультимедиа --- SRTP разработан специально для защищенной передачи аудио и видео данных, в отличие от более универсального TCP+TLS.
\end{itemize}
  
Недостатки:

\begin{itemize}[label=---]
  \item Меньшая надежность --- UDP, лежащий в основе SRTP, не гарантирует доставку данных, что может привести к потере пакетов в неблагоприятных сетевых условиях.
  \item Сложность реализации --- SRTP требует реализации дополнительных механизмов для управления ключами шифрования, что усложняет разработку.
\end{itemize}

\section{Распределение вычислений}

При централизованном проведении конференций основная нагрузка ложится на сервер, в то время как при проведении бессерверных конференций она распределяется по клиентам. Для обеспечения наилучшего QoS необходимо учитывать вычислительные возможности каждого клиента, а также пропускную способность каналов, объединяющих их.

В бессерверной архитектуре каждый участник конференции выступает в качестве автономного узла, ответственного за обработку и передачу мультимедийного контента. Это требует от клиентских устройств достаточной вычислительной мощности для кодирования, декодирования и синхронизации аудио, видео и данных в режиме реального времени.

\begin{equation}
  \textit{Perf}_{client} = f(CPU, GPU, RAM)
\end{equation}

Пропускная способность каналов связи также играет критическую роль, определяя максимально возможное качество и разрешение передаваемых потоков. Недостаточная пропускная способность может привести к снижению качества и стабильности соединения, а также к возникновению задержек и потерь пакетов.

\begin{equation}
  \textit{Bandwidth}_{channel}=f(\textit{network~speed},\textit{distance},\textit{noises})
\end{equation}

Для достижения оптимального QoS в бессерверных конференциях необходимо динамически адаптировать параметры кодирования и передачи мультимедийных потоков к возможностям каждого участника. Это может быть реализовано с помощью механизмов согласования характеристик сессии и адаптивного управления скоростью передачи данных.

\section{Микширование}

При большом числе участников в бессерверных видеоконференциях имеет смысл применять микширование передаваемых видео потоков. Это позволяет уменьшить общий объем передаваемых данных, снизив нагрузку на каналы связи, но при этом требует значительных вычислительных ресурсов от клиентских устройств.

Процесс микширования видео можно представить в виде следующих основных шагов:

\begin{enumerate}
\item Получение видео кадров от соседних узлов.
\item Декодирование полученных кадров.
\item Композиция единого кадра путем пространственного объединения (склеивания) исходных кадров.
\item Кодирование скомпонованного кадра.
\item Передача закодированного кадра всем соседним узлам.
\end{enumerate}

При этом, на этапе формирования общего кадра необходимо учитывать, нужен ли тот или иной видео поток каждому из соседних участников. Это позволяет оптимизировать состав композитного кадра и снизить вычислительную нагрузку.

Микширование аудио потоков может быть реализовано схожим образом, с формированием раздельных аудио каналов для каждого участника конференции. Это требует дополнительных вычислений, связанных с микшированием, кодированием и передачей аудио данных.

Эффективность микширования определяется соотношением выигрыша в объеме передаваемых данных и затратами вычислительных ресурсов на клиентских устройствах. Для поддержания высокого качества и низкой задержки передачи мультимедийного контента необходим тщательный подбор алгоритмов микширования и кодирования с учетом возможностей участников конференции.

\section{Устойчивость конференции}

Отключение ключевого участника конференции, через которого проходит большое число потоков данных от других участников, является одной из проблем распределенных вычислений. Решением этой проблемы может послужить механизм, обеспечивающий поддержание <<запасных>> каналов передачи между клиентами.

\section{Защита информации}

Для защиты конференции необходимо использовать защищенные каналы передачи. На каждое соединение инициализируется собственная сессия, вместо того, чтобы использовать одну сессию на всех участников конференции.

Плюсы такого подхода:
\begin{itemize}[label=---]
  \item Повышение безопасности за счет использования индивидуальных криптографических ключей для каждого соединения.
  \item Улучшение масштабируемости системы, так как каждое соединение обрабатывается независимо.
  \item Более гибкое управление доступом и привилегиями участников конференции.
\end{itemize}

Минусы такого подхода:
\begin{itemize}[label=---]
  \item Увеличение вычислительной нагрузки на клиентские устройства, связанное с необходимостью поддержания множества криптографических сессий.
  \item Более высокие требования к пропускной способности канала связи, обусловленные необходимостью передачи дополнительных данных, связанных с криптографической защитой.
\end{itemize}

В программной реализации протокола применяется библиотека OpenSSL \cite{openssl} для осуществления защищенных соединений. Использование OpenSSL позволяет обеспечить совместимость с широким спектром криптографических алгоритмов, а также реализовать такие механизмы безопасности, как аутентификация, шифрование и целостность передаваемых данных. Кроме того, OpenSSL предоставляет средства для управления криптографическими ключами, что упрощает интеграцию защищенных соединений в общую архитектуру системы.

\section{Особенности NAT}

Одной из ключевых проблем при реализации бессерверных видеоконференций является преодоление ограничений, связанных с трансляцией адресов.
NAT используется для преобразования частных IP-адресов в публичные и наоборот, что позволяет нескольким устройствам в локальной сети использовать один публичный IP-адрес для выхода в интернет.
Однако NAT создает сложности для прямого соединения между участниками, находящимися за разными NAT, так как они не могут напрямую обмениваться данными без дополнительных механизмов.

Выделяют следующие типы реализаций NAT по способу обработки UDP пакетов \cite{nat-types}:
\begin{itemize}[label=---]
  \item \textit{Конус (Full Cone)}.
  Все запросы с одного и того же внутреннего IP адреса и порта отображаются на один и тот же внешний IP адрес и порт.
  Любой внешний хост может отправить пакет внутреннему хосту, отправляя его на отображенный врешний IP адрес.
  %A full cone NAT is one where all requests from the same internal IP address and port are mapped to the same external IP address and port. Furthermore, any external host can send a packet to the internal host, and it sends a packet to the mapped external address.

  \item \textit{Ограниченный конус (Restricted Cone)}.
  То же, что и конус, за исключением того, что внешний хост (с IP адресом Х) может отправить пакет внутреннему хосту только если ранее внутренний хост отправлял пакет внешнему хосту по IP адресу Х.
  %A restricted cone NAT is one where all requests from the same internal IP address and port are mapped to the same external IP address and port. Unlike a full cone NAT, an external host (with IP address X) can send a packet to the internal host only if the internal host had previously sent a packet to IP address X.   
  
  \item \textit{Конус, ограниченный портами (Port Restricted Cone)}.
  То же, что и ограниченный конус, но включая ограничение на порты --- внешний хост (c IP адресом Х и портом Р) может отправить пакет внутреннему хосту только если ранее внутренний хост отравлял пакет внешнему хосту по IP адресу X и порту P.
  %A port-restricted cone NAT is like a restricted cone NAT, but the restriction includes port numbers. Specifically, an external host can send a packet, with source IP address X and source port P, to the internal host only if the internal host had previously sent a packet to IP address X and port P.   
  
  \item \textit{Симметричный (Symmetric)}.
  Все запросы с одного и того же внутреннего IP адреса и порта к одному и тому же IP адресу и порту хоста назначения отображаются на один и тот же внешний IP адрес и порт.
  Если один хост отправляет пакет с тем же IP адресом и портом источника, но с другим адресом назначения, то используется другое отображение.
  Более того, только внешний хост, получивший пакет, может отправить UDP пакет обратно источнику, находящемуся за NAT. 
  %A symmetric NAT is one where all requests from the same internal IP address and port to a specific destination IP address and port, are mapped to the same external IP address and port.  If the same host sends a packet with the same source address and port, but to a different destination, a different mapping is used.  Furthermore, only the external host that receives a packet can send a UDP packet back to the internal host.
\end{itemize}

Для преодоления ограничений NAT в бессерверных конференциях используются следующие подходы:
\begin{enumerate}
  \item STUN (Session Traversal Utilities for NAT).
  STUN --- это протокол, который позволяет участникам, находящимся за NAT, определить свой публичный IP-адрес и порт, назначенный NAT для исходящего соединения.
  Это позволяет участникам обмениваться этой информацией и устанавливать прямое соединение.
  
  Принцип работы STUN заключается в том, что каждый участник отправляет запрос на STUN-сервер, который возвращает ему его публичный IP-адрес и порт.
  Затем они обмениваются этой информацией через сигнальный канал.
  После обмена информацией участники пытаются установить прямое соединение через публичные IP-адреса и порты.
  
  STUN Позволяет установить прямое соединение между участниками, находящимися за NAT.
  Не требует дополнительных серверов для ретрансляции данных.
  Однако, он не работает с симметричным NAT.
  
  \item TURN (Traversal Using Relays around NAT).
  TURN --- это протокол, который позволяет участникам, находящимся за NAT, использовать ретрансляционный сервер для передачи данных, если прямое соединение невозможно.
  TURN-сервер выступает в качестве посредника, пересылая данные между участниками.
  
  Как работает TURN: участники устанавливают соединение с TURN-сервером и получают от него публичный IP-адрес и порт для ретрансляции данных, после чего обмениваются этой информацией через сигнальный канал.
  Если прямое соединение невозможно, данные передаются через TURN-сервер.
  
  TURN работает с любыми типами NAT, включая симметричный и обеспечивает надежную передачу данных даже в сложных сетевых условиях.
  Но данный подход требует наличия TURN-сервера, что увеличивает затраты на инфраструктуру, а также вводит дополнительную задержку из-за ретрансляции данных через сервер.
  
  \item ICE (Interactive Connectivity Establishment).
  ICE --- это технология, которая объединяет STUN и TURN для установления соединения между участниками.
  ICE автоматически выбирает оптимальный способ соединения: прямое (через STUN) или через ретрансляционный сервер (TURN).
  
  При использовании ICE участники собирают все возможные кандидаты для соединения (локальные IP-адреса, публичные IP-адреса через STUN, ретрансляционные адреса через TURN) и обмениваются списками кандидатов через сигнальный канал.
  ICE проверяет каждый кандидат и выбирает оптимальный путь для соединения.
  
  Преимущества: автоматический выбор лучшего способа соединения, поддержка всех типов NAT, включая симметричный.
  Ограничения: требуются интеграции STUN и TURN серверов, увеличенная сложность реализации.

  \item UPnP (Universal Plug and Play).
  UPnP --- это протокол, позволяющий устройствам автоматически настраивать проброс портов на NAT-устройствах (например, роутерах).
  Если участник поддерживает UPnP, он может автоматически открыть порт для входящих соединений.

  Как работает UPnP: участник отправляет запрос на роутер через UPnP для открытия порта; роутер открывает порт и назначает его для входящих соединений; участник использует этот порт для приема данных от других участников.

  UPnP позволяет участникам принимать входящие соединения без ручной настройки NAT и  упрощает установление прямых соединений.
  Однако не все роутеры его поддерживают, а также он может быть отключен по соображениям безопасности.

  \item Использование P2P-технологий с NAT-пробросом.
  В некоторых случаях можно использовать P2P-технологии, такие как UDP hole punching, которые позволяют участникам устанавливать прямое соединение через NAT без использования промежуточных серверов.

  Участники обмениваются информацией о своих публичных IP-адресах и портах через сигнальный канал, затем одновременно отправляют UDP-пакеты друг другу, что позволяет установить прямое соединение через NAT.

  Данный способ не требует дополнительных серверов для ретрансляции данных и подходит для большинства типов NAT, кроме симметричного, однако для его работы требуется точная синхронизация между участниками.
\end{enumerate}
